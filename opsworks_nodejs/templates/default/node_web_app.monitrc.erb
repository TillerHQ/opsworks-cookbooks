check host node_web_app_<%= @application_name %> with address 127.0.0.1
  start program = "/bin/bash -c 'cd <%= @deploy[:deploy_to] %>/current ; source <%= @deploy[:deploy_to] %>/shared/app.env ; touch <%= @deploy[:deploy_to]%>/shared/log/node.stdout.log ; <%= @deploy[:deploy_to]%>/shared/log/node.stderr.log ; chmod 640 <%= @deploy[:deploy_to]%>/shared/log/node.stdout.log ; chmod 640 <%= @deploy[:deploy_to]%>/shared/log/node.stderr.log ; /usr/bin/env PORT=<%= @deploy[:nodejs][:port] %> NODE_PATH=<%= @deploy[:deploy_to] %>/current/node_modules:<%= @deploy[:deploy_to] %>/current /usr/local/bin/node <%= @monitored_script %> 2>> <%= @deploy[:deploy_to]%>/shared/log/node.stderr.log 1>> <%= @deploy[:deploy_to]%>/shared/log/node.stdout.log'" as uid "<%= @deploy[:user] %>" and gid "<%= @deploy[:group] %>"
  stop program = "/usr/bin/pkill -f 'node <%= @monitored_script %>'"
  <% if @deploy[:ssl_support] -%>
  if failed port <%= @deploy[:nodejs][:port] %> type TCPSSL protocol HTTP
  <% else -%>
  if failed port <%= @deploy[:nodejs][:port] %> protocol HTTP
  <% end -%>
    request <%= @deploy[:status_path] %>
    with timeout 10 seconds
    then restart
